<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Cart - AKC Auto Parts</title>
  <link rel="icon" type="image/png" href="https://th.bing.com/th/id/R.35647c0cec927537fa43ed1836a446c2?rik=7Lzu71WwPczowA&riu=http%3a%2f%2fpluspng.com%2fimg-png%2fhyundai-logo-png-hyundai-car-logo-png-brand-image-1749.png&ehk=UI8O%2bS7ci5lpalKI9Rf1u%2bMYvCgw%2bVwAeupMAcxmk2g%3d&risl=&pid=ImgRaw&r=0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/mobile-ui.css">

  <!-- Google Font -->
 <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">


<style>
*{
  box-sizing:border-box;
}

body{
  font-family:'Nunito Sans',sans-serif;
  background:linear-gradient(135deg,#e8f2ff,#ffffff);
  margin:0;
  padding:24px;
}

/* ================= HEADER FEEL ================= */
header{
  background:#ffffff;
  border-radius:16px;
  padding:12px 20px;
  box-shadow:0 8px 24px rgba(0,0,0,0.12);
}

/* ================= CART CONTAINER ================= */
.box{
  max-width:950px;
  margin:0 auto;
  background:#ffffff;
  padding:30px;
  border-radius:22px;
  box-shadow:0 20px 50px rgba(0,0,0,0.12);
  animation:fadeUp .6s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(25px)}
  to{opacity:1;transform:translateY(0)}
}

h2{
  text-align:center;
  font-size:30px;
  font-weight:800;
  margin-bottom:25px;
  color:#0f172a;
}

/* ================= TABLE ================= */
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 14px;
}

th{
  background:#0f172a;
  color:#fff;
  padding:14px;
  border-radius:10px;
  font-size:14px;
  text-transform:uppercase;
  letter-spacing:.5px;
}

td{
  background:#f8fafc;
  padding:16px;
  border-radius:14px;
  font-size:15px;
  transition:.3s ease;
}

tr:hover td{
  background:#eef4ff;
  transform:scale(1.01);
}

/* ================= QTY INPUT ================= */
input[type="number"]{
  width:70px;
  padding:8px;
  border-radius:10px;
  border:1px solid #d1d5db;
  text-align:center;
  font-size:15px;
  transition:.25s ease;
}

input[type="number"]:focus{
  outline:none;
  border-color:#2563eb;
  box-shadow:0 0 0 3px rgba(37,99,235,.15);
}

/* ================= BUTTONS ================= */
.btn{
  background:#0f172a;
  color:#fff;
  border:none;
  padding:12px 20px;
  border-radius:12px;
  cursor:pointer;
  font-weight:700;
  font-size:15px;
  transition:.3s ease;
}

.btn:hover{
  background:#1e293b;
  transform:translateY(-2px);
}

.btn.secondary{
  background:transparent;
  color:#0f172a;
  border:2px solid #0f172a;
}

.btn.secondary:hover{
  background:#0f172a;
  color:#fff;
}

/* ================= TOTAL BOX ================= */
.total-box{
  margin-top:30px;
  background:linear-gradient(135deg,#eef4ff,#e0ebff);
  border-radius:16px;
  padding:20px;
  text-align:right;
  font-size:24px;
  font-weight:800;
  color:#0f172a;
  box-shadow:0 8px 24px rgba(0,0,0,0.1);
}

/* ================= EMPTY CART ================= */
.empty-msg{
  text-align:center;
  font-size:18px;
  padding:30px;
  color:#6b7280;
}

/* ================= FLOAT EFFECT ================= */
.btn-float{
  animation:float 3s ease-in-out infinite;
}

@keyframes float{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-6px)}
}

/* ================= POPUP ================= */
.popup-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.popup-box{
  background:#fff;
  width:340px;
  padding:28px;
  border-radius:18px;
  text-align:center;
  box-shadow:0 20px 40px rgba(0,0,0,.25);
  animation:popup .3s ease;
}

@keyframes popup{
  from{transform:scale(.85);opacity:0}
  to{transform:scale(1);opacity:1}
}

.popup-box h3{
  margin-bottom:10px;
  font-size:22px;
  font-weight:800;
}

.popup-box p{
  color:#4b5563;
  font-size:15px;
}

.popup-btn{
  padding:12px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  border:none;
}

.popup-btn.signin{
  background:#0f172a;
  color:#fff;
}

.popup-btn.cancel{
  background:#e5e7eb;
  color:#111827;
}

/* ================= LANGUAGE DROPDOWN ================= */

.lang-select {
  position: relative;
  display: inline-block;
}

.lang-select select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background: #ffffff;
  border: 2px solid #2563eb;
  border-radius: 8px;

  padding: 8px 36px 8px 12px;
  font-size: 13px;
  font-weight: 600;
  color: #2563eb;

  cursor: pointer;
  outline: none;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(37, 99, 235, 0.12);
}

.lang-select select:hover {
  border-color: #1e40af;
  background: #f0f9ff;
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
}

.lang-select select:focus {
  border-color: #1e40af;
  background: #f0f9ff;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1), 0 4px 12px rgba(37, 99, 235, 0.2);
}

.lang-select::after {
  content: "ðŸŒ";
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 16px;
  pointer-events: none;
  transition: transform 0.3s ease;
}

.lang-select select:hover::after {
  transform: translateY(-50%) scale(1.1);
}

.lang-select select:focus::after {
  transform: translateY(-50%) scale(1.15);
}

.lang-select select option {
  background: #ffffff;
  color: #2563eb;
  padding: 8px;
  font-weight: 600;
}

.lang-select select option:hover {
  background: #2563eb;
  color: #ffffff;
}

.lang-select select option:checked {
  background: #2563eb;
  color: #ffffff;
  font-weight: 700;
}

/* ===============================
   MOBILE RESPONSIVE STYLES
   =============================== */

@media(max-width:768px){
  body{
    padding:15px 10px;
  }
  
  header{
    flex-wrap:wrap;
    padding:10px 15px;
    gap:10px;
  }
  
  header img{
    height:30px;
  }
  
  header > div:first-child{
    font-size:14px;
  }
  
  .box{
    padding:15px;
    border-radius:16px;
  }
  
  h2{
    font-size:22px;
    margin-bottom:15px;
  }
  
  table{
    display:block;
    overflow-x:auto;
    white-space:nowrap;
    border-spacing:0 10px;
  }
  
  th{
    padding:10px 8px;
    font-size:12px;
  }
  
  td{
    padding:12px 8px;
    font-size:13px;
  }
  
  input[type="number"]{
    width:55px;
    padding:6px;
    font-size:13px;
  }
  
  .btn{
    padding:10px 14px;
    font-size:13px;
    border-radius:10px;
  }
  
  .total-box{
    padding:15px;
    font-size:18px;
    border-radius:12px;
  }
  
  .popup-box{
    width:90%;
    padding:20px;
  }
}

@media(max-width:480px){
  body{
    padding:10px 8px;
  }
  
  header{
    padding:8px 12px;
  }
  
  header img{
    height:26px;
  }
  
  header > a > div{
    font-size:12px;
  }
  
  .box{
    padding:12px;
    border-radius:14px;
  }
  
  h2{
    font-size:18px;
  }
  
  /* Convert table to card layout on mobile */
  table, thead, tbody, th, td, tr{
    display:block;
  }
  
  thead tr{
    position:absolute;
    top:-9999px;
    left:-9999px;
  }
  
  tr{
    margin-bottom:15px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    padding:12px;
    background:#f8fafc;
  }
  
  td{
    border:none;
    position:relative;
    padding:8px 8px 8px 45%;
    text-align:right;
    white-space:normal;
  }
  
  td:before{
    position:absolute;
    left:12px;
    width:40%;
    padding-right:10px;
    text-align:left;
    font-weight:700;
    color:#374151;
    font-size:12px;
  }
  
  td:nth-of-type(1):before { content: "Product"; }
  td:nth-of-type(2):before { content: "Qty"; }
  td:nth-of-type(3):before { content: "Subtotal"; }
  td:nth-of-type(4):before { content: "Action"; }
  
  input[type="number"]{
    width:50px;
    padding:5px;
    font-size:12px;
  }
  
  .btn{
    padding:8px 12px;
    font-size:12px;
  }
  
  .total-box{
    padding:12px;
    font-size:16px;
    text-align:center;
  }
  
  div[style*="display:flex"][style*="gap:10px"]{
    flex-direction:column;
  }
  
  .btn.secondary,
  #checkoutBtn{
    width:100%;
  }
  
  .popup-box{
    width:95%;
    padding:18px;
    border-radius:14px;
  }
  
  .popup-box h3{
    font-size:18px;
  }
  
  .popup-box p{
    font-size:13px;
  }
  
  .lang-select select{
    padding:6px 28px 6px 10px;
    font-size:12px;
  }
}

/* Tablet styles */
@media(min-width:481px) and (max-width:768px){
  table{
    font-size:14px;
  }
  
  th, td{
    padding:12px 10px;
  }
}
@media (max-width: 480px) {
  table {
    width: 100%;
  }

  tr {
    margin-bottom: 16px;
  }

  td {
    font-size: 13px;
  }
}
/* ===============================
   RESPONSIVE BREAKPOINT SYSTEM
================================ */

/* Tablets */
@media (max-width: 992px) {
  body {
    padding: 15px;
  }

  .container,
  .box {
    padding: 20px;
  }
}

/* Mobiles */
@media (max-width: 600px) {
  body {
    padding: 10px;
  }

  h1 { font-size: 20px; }
  h2 { font-size: 18px; }
  h3 { font-size: 16px; }

  p, span {
    font-size: 14px;
  }
}

/* Small phones */
@media (max-width: 420px) {
  h1 { font-size: 18px; }
  h2 { font-size: 16px; }
  p  { font-size: 13px; }
}
/* ===============================
   GLOBAL RESPONSIVE RESET
================================ */

* {
  box-sizing: border-box;
  max-width: 100%;
}

html, body {
  width: 100%;
  overflow-x: hidden;
}

/* Images auto resize */
img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Containers */
.container,
.box,
.orders-wrapper,
.media,
.meta {
  width: 100%;
  max-width: 1200px;
  margin: auto;
}

/* Buttons full width on mobile */
@media (max-width: 600px) {
  button,
  .btn {
    width: 100%;
  }
}
/* ===============================
   GLOBAL RESPONSIVE RESET
================================ */

* {
  box-sizing: border-box;
  max-width: 100%;
}

html, body {
  width: 100%;
  overflow-x: hidden;
}

/* Images auto resize */
img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Containers */
.container,
.box,
.orders-wrapper,
.media,
.meta {
  width: 100%;
  max-width: 1200px;
  margin: auto;
}

/* Buttons full width on mobile */
@media (max-width: 600px) {
  button,
  .btn {
    width: 100%;
  }
}
/* ===============================
   GLOBAL RESPONSIVE RESET
================================ */

* {
  box-sizing: border-box;
  max-width: 100%;
}

html, body {
  width: 100%;
  overflow-x: hidden;
}

/* Images auto resize */
img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Containers */
.container,
.box,
.orders-wrapper,
.media,
.meta {
  width: 100%;
  max-width: 1200px;
  margin: auto;
}

/* Buttons full width on mobile */
@media (max-width: 600px) {
  button,
  .btn {
    width: 100%;
  }
}

</style>

</head>

<body>
<header style="max-width:1150px;margin:0 auto 18px;padding:6px 0;display:flex;align-items:center;gap:12px;">

  <!-- LOGO CLICK â†’ HOME -->
  <a href="/" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
    
    <img 
      src="https://th.bing.com/th/id/R.35647c0cec927537fa43ed1836a446c2?rik=7Lzu71WwPczowA&riu=http%3a%2f%2fpluspng.com%2fimg-png%2fhyundai-logo-png-hyundai-car-logo-png-brand-image-1749.png&ehk=UI8O%2bS7ci5lpalKI9Rf1u%2bMYvCgw%2bVwAeupMAcxmk2g%3d&risl=&pid=ImgRaw&r=0"
      alt="AKC AUTO PARTS"
      style="height:38px;cursor:pointer;"
    >

    <div style="font-weight:800;font-size:16px;cursor:pointer;">
      AKC AUTO PARTS
    </div>

  </a>

  <div style="margin-left:auto;color:var(--muted);font-size:14px;">
    <%= t.partsFor %>
  </div>

</header>

<div class="box">

  <table>
    <thead>
      <tr>
        <th><%= t.product %></th>
        <th><%= t.qty %></th>
        <th><%= t.subtotal %></th>
        <th><%= t.action %></th>
      </tr>
    </thead>
    <tbody id="cartRows"></tbody>
  </table>

  <div class="total-box">
    <%= t.grandTotal %>: â‚¹<span id="grandTotal">0</span>
  </div>

  <div style="margin-top:25px; display:flex; gap:10px; justify-content:center;">
    <button class="btn secondary btn-float" onclick="window.location.href='/'">
      â¬… <%= t.continueShopping %>
    </button>
    <button id="checkoutBtn" class="btn btn-float" onclick="goToRegistration()" disabled style="opacity: 0.5; cursor: not-allowed;">
      <%= t.checkout %> â†’
    </button>
  </div>
</div>


<script>
/* Language translations */
const t = <%- JSON.stringify(t) %>;


const LS_CART_KEY = 'akc_cart_v1';

/* ---------------- CART STORAGE ---------------- */
function loadCart(){
  try {
    return JSON.parse(localStorage.getItem(LS_CART_KEY)) || [];
  } catch {
    return [];
  }
}

function saveCart(cart){
  localStorage.setItem(LS_CART_KEY, JSON.stringify(cart));
}

/* ---------------- GLOBAL PRODUCT CACHE ---------------- */
let PRODUCTS = [];

/* ---------------- FETCH GOOGLE SHEET PRODUCTS ---------------- */
async function loadProducts(){
  const res = await fetch("/api/products");
  PRODUCTS = await res.json();
}

/* ---------------- FIND PRODUCT ---------------- */
function getProduct(id){
  return PRODUCTS.find(p => p.id === id);
}

/* ---------------- RENDER CART ---------------- */
async function renderCart(){

  await loadProducts();

  const cart = loadCart();
  const tbody = document.getElementById("cartRows");
  const totalEl = document.getElementById("grandTotal");

  tbody.innerHTML = "";

  if(cart.length === 0){
    tbody.innerHTML =
      `<tr><td colspan="4" class="empty-msg">Your cart is empty</td></tr>`;
    totalEl.textContent = "0";
    return;
  }

  let total = 0;

  cart.forEach(item => {
    const p = getProduct(item.id);
    if(!p) return;

    const subtotal = p.price * item.qty;
    total += subtotal;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>
        <strong>${p.name}</strong><br>
        <small>${p.id}</small>
      </td>
      <td>
        <input type="number" min="1" value="${item.qty}"
          onchange="changeQty('${item.id}', this.value)">
      </td>
      <td><strong>â‚¹${subtotal.toLocaleString()}</strong></td>
      <td>
        <button class="btn secondary"
          onclick="removeItem('${item.id}')">
          Remove
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  totalEl.textContent = total.toLocaleString();

  // checkout button enable/disable
  const checkoutBtn = document.getElementById("checkoutBtn");
  checkoutBtn.disabled = total <= 0;
  checkoutBtn.style.opacity = total <= 0 ? "0.5" : "1";
}

/* ---------------- CART ACTIONS ---------------- */
function changeQty(id, value){
  const cart = loadCart();
  const item = cart.find(i => i.id === id);
  if(item){
    item.qty = Math.max(1, Number(value));
    saveCart(cart);
    renderCart();
  }
}

function removeItem(id){
  let cart = loadCart();
  cart = cart.filter(i => i.id !== id);
  saveCart(cart);
  renderCart();
}

/* ---------------- CHECKOUT ---------------- */
function goToRegistration(){
  const cart = loadCart();
  if(cart.length === 0){
    alert("Cart is empty");
    return;
  }

  const isLoggedIn = "<%= session && session.user ? 'true' : 'false' %>";
  if(isLoggedIn !== "true"){
    document.getElementById("signinPopup").style.display = "flex";
    return;
  }

  window.location.href = "/registration";
}

/* ---------------- INIT ---------------- */
document.addEventListener("DOMContentLoaded", renderCart);
function goToSignin(){
  window.location.href = "/signin";
}

function closePopup(){
  document.getElementById("signinPopup").style.display = "none";
}


</script>
<div id="signinPopup" class="popup-overlay">
  <div class="popup-box">
    <h3><%= t.pleaseSignIn %></h3>
    <p><%= t.mustSignInCheckout %></p>

    <div class="popup-actions">
      <button class="popup-btn signin" onclick="goToSignin()"><%= t.signIn %></button>
      <button class="popup-btn cancel" onclick="closePopup()"><%= t.no %></button>
    </div>
  </div>
</div>

</body>
</html>
